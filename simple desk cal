cal.l-----------------

lex

%{
#include "y.tab.h"
%}

digit   [0-9]+

%%

{digit}     { yylval = atoi(yytext); return NUM; }
[ \t]+      { /* skip spaces */ }
"\n"        { return EOL; }
"+"         { return '+'; }
"*"         { return '*'; }
"("         { return '('; }
")"         { return ')'; }
.           { return yytext[0]; }

%%

int yywrap() { return 1; }

cal.y---------------------

%{
#include <stdio.h>
#include <stdlib.h>
int yylex();
void yyerror(const char *s);
%}

%token NUM EOL
%left '+'
%left '*'

%%

input:
        /* empty */
        | input line
        ;

line:
        expr EOL      { printf("= %d\n", $1); }
        | EOL         { /* blank line */ }
        ;

expr:
        expr '+' expr   { $$ = $1 + $3; }
        | expr '*' expr { $$ = $1 * $3; }
        | '(' expr ')'  { $$ = $2; }
        | NUM           { $$ = $1; }
        ;

%%

void yyerror(const char *s) { 
    fprintf(stderr, "Error: %s\n", s);
}

int main() {
    printf("Enter expressions, newline to evaluate.\n");
    yyparse();
    return 0;
}
